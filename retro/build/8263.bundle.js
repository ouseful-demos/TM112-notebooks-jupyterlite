(self.webpackChunk_JUPYTERLAB_CORE_OUTPUT=self.webpackChunk_JUPYTERLAB_CORE_OUTPUT||[]).push([[8263],{31955:(s,e,n)=>{"use strict";n.d(e,{M:()=>t});const t=()=>{let s=!0;return(e,n)=>{if(s){s=!1;try{e()}finally{s=!0}}else void 0!==n&&n()}}},8263:(s,e,n)=>{"use strict";n.d(e,{V:()=>P});var t=n(23205),c=n(24803),a=n(55852);const o=new Map,i="undefined"==typeof BroadcastChannel?class{constructor(s){this.room=s,this.onmessage=null,a.z((e=>e.key===s&&null!==this.onmessage&&this.onmessage({data:c.Gh(e.newValue||"")})))}postMessage(s){a.X.setItem(this.room,c.s3(c.eh(s)))}}:BroadcastChannel,r=s=>t.Yu(o,s,(()=>{const e=new Set,n=new i(s);return n.onmessage=s=>e.forEach((e=>e(s.data))),{bc:n,subs:e}})),h=(s,e)=>{const n=r(s);n.bc.postMessage(e),n.subs.forEach((s=>s(e)))};var d=n(40870),l=n(23406),u=n(49e3),w=n(90355);const f=(s,e)=>{l.uE(s,0);const n=w.gJ(e);l.mP(s,n)},b=(s,e,n)=>{l.uE(s,1),l.mP(s,w.D$(e,n))},m=(s,e,n)=>{try{w.NG(e,u.HN(s),n)}catch(s){console.error("Caught error while handling a Yjs update",s)}},y=m;var _=n(6493),g=n(31955),p=n(75736),E=n(21332),v=n(69600);const C=[];C[0]=(s,e,n,t,c)=>{l.uE(s,0);const a=((s,e,n,t)=>{const c=u.yg(s);switch(c){case 0:((s,e,n)=>{b(e,n,u.HN(s))})(s,e,n);break;case 1:m(s,n,t);break;case 2:y(s,n,t);break;default:throw new Error("Unknown message type")}return c})(e,s,n.doc,n);t&&1===a&&!n.synced&&(n.synced=!0)},C[3]=(s,e,n,t,c)=>{l.uE(s,1),l.mP(s,_.xq(n.awareness,Array.from(n.awareness.getStates().keys())))},C[1]=(s,e,n,t,c)=>{_.oy(n.awareness,u.HN(e),n)},C[2]=(s,e,n,t,c)=>{((s,e,n)=>{switch(u.yg(s)){case 0:n(e,u.kf(s))}})(e,n.doc,M)};const M=(s,e)=>console.warn(`Permission denied to access ${s.url}.\n${e}`),I=(s,e,n)=>{const t=u.l1(e),c=l.Mf(),a=u.yg(t),o=s.messageHandlers[a];return o?o(c,t,s,n,a):console.error("Unable to compute message"),c},U=s=>{if(s.shouldConnect&&null===s.ws){const e=new s._WS(s.url);e.binaryType="arraybuffer",s.ws=e,s.wsconnecting=!0,s.wsconnected=!1,s.synced=!1,e.onmessage=n=>{s.wsLastMessageReceived=d.ZG();const t=I(s,new Uint8Array(n.data),!0);l.kE(t)>1&&e.send(l._f(t))},e.onclose=()=>{s.ws=null,s.wsconnecting=!1,s.wsconnected?(s.wsconnected=!1,s.synced=!1,_.Ag(s.awareness,Array.from(s.awareness.getStates().keys()).filter((e=>e!==s.doc.clientID)),s),s.emit("status",[{status:"disconnected"}])):s.wsUnsuccessfulReconnects++,setTimeout(U,E.VV(1200*E.mv(s.wsUnsuccessfulReconnects+1),2500),s)},e.onopen=()=>{s.wsLastMessageReceived=d.ZG(),s.wsconnecting=!1,s.wsconnected=!0,s.wsUnsuccessfulReconnects=0,s.emit("status",[{status:"connected"}]);const n=l.Mf();if(l.uE(n,0),f(n,s.doc),e.send(l._f(n)),null!==s.awareness.getLocalState()){const n=l.Mf();l.uE(n,1),l.mP(n,_.xq(s.awareness,[s.doc.clientID])),e.send(l._f(n))}},s.emit("status",[{status:"connecting"}])}},k=(s,e)=>{s.wsconnected&&s.ws.send(e),s.bcconnected&&s.mux((()=>{h(s.bcChannel,e)}))};class P extends p.y{constructor(s,e,n,{connect:t=!0,awareness:c=new _.GL(n),params:a={},WebSocketPolyfill:o=WebSocket,resyncInterval:i=-1}={}){for(super();"/"===s[s.length-1];)s=s.slice(0,s.length-1);const r=(s=>v.UI(s,((s,e)=>`${encodeURIComponent(e)}=${encodeURIComponent(s)}`)).join("&"))(a);this.bcChannel=s+"/"+e,this.url=s+"/"+e+(0===r.length?"":"?"+r),this.roomname=e,this.doc=n,this._WS=o,this.awareness=c,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.wsUnsuccessfulReconnects=0,this.messageHandlers=C.slice(),this.mux=g.M(),this._synced=!1,this.ws=null,this.wsLastMessageReceived=0,this.shouldConnect=t,this._resyncInterval=0,i>0&&(this._resyncInterval=setInterval((()=>{if(this.ws){const s=l.Mf();l.uE(s,0),f(s,n),this.ws.send(l._f(s))}}),i)),this._bcSubscriber=s=>{this.mux((()=>{const e=I(this,new Uint8Array(s),!1);l.kE(e)>1&&h(this.bcChannel,l._f(e))}))},this._updateHandler=(s,e)=>{if(e!==this){const e=l.Mf();l.uE(e,0),((s,e)=>{l.uE(s,2),l.mP(s,e)})(e,s),k(this,l._f(e))}},this.doc.on("update",this._updateHandler),this._awarenessUpdateHandler=({added:s,updated:e,removed:n},t)=>{const a=s.concat(e).concat(n),o=l.Mf();l.uE(o,1),l.mP(o,_.xq(c,a)),k(this,l._f(o))},"undefined"!=typeof window&&window.addEventListener("beforeunload",(()=>{_.Ag(this.awareness,[n.clientID],"window unload")})),c.on("update",this._awarenessUpdateHandler),this._checkInterval=setInterval((()=>{this.wsconnected&&3e4<d.ZG()-this.wsLastMessageReceived&&this.ws.close()}),3e3),t&&this.connect()}get synced(){return this._synced}set synced(s){this._synced!==s&&(this._synced=s,this.emit("synced",[s]),this.emit("sync",[s]))}destroy(){0!==this._resyncInterval&&clearInterval(this._resyncInterval),clearInterval(this._checkInterval),this.disconnect(),this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("update",this._updateHandler),super.destroy()}connectBc(){var s,e;this.bcconnected||(s=this.bcChannel,e=this._bcSubscriber,r(s).subs.add(e),this.bcconnected=!0),this.mux((()=>{const s=l.Mf();l.uE(s,0),f(s,this.doc),h(this.bcChannel,l._f(s));const e=l.Mf();l.uE(e,0),b(e,this.doc),h(this.bcChannel,l._f(e));const n=l.Mf();l.uE(n,3),h(this.bcChannel,l._f(n));const t=l.Mf();l.uE(t,1),l.mP(t,_.xq(this.awareness,[this.doc.clientID])),h(this.bcChannel,l._f(t))}))}disconnectBc(){const s=l.Mf();var e,n;l.uE(s,1),l.mP(s,_.xq(this.awareness,[this.doc.clientID],new Map)),k(this,l._f(s)),this.bcconnected&&(e=this.bcChannel,n=this._bcSubscriber,r(e).subs.delete(n),this.bcconnected=!1)}disconnect(){this.shouldConnect=!1,this.disconnectBc(),null!==this.ws&&this.ws.close()}connect(){this.shouldConnect=!0,this.wsconnected||null!==this.ws||(U(this),this.connectBc())}}}}]);
//# sourceMappingURL=8263.bundle.js.map