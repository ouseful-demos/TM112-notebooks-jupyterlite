(self.webpackChunk_JUPYTERLAB_CORE_OUTPUT=self.webpackChunk_JUPYTERLAB_CORE_OUTPUT||[]).push([[9779,6839],{54605:(e,t,s)=>{"use strict";s.r(t),s.d(t,{CodeConsole:()=>x,ConsoleHistory:()=>r,ConsolePanel:()=>D,ForeignHandler:()=>o,IConsoleTracker:()=>I});var n,i=s(58137);class o{constructor(e){this._enabled=!1,this._isDisposed=!1,this.sessionContext=e.sessionContext,this.sessionContext.iopubMessage.connect(this.onIOPubMessage,this),this._parent=e.parent}get enabled(){return this._enabled}set enabled(e){this._enabled=e}get parent(){return this._parent}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,i.Signal.clearData(this))}onIOPubMessage(e,t){var s;if(!this._enabled)return!1;const n=null===(s=this.sessionContext.session)||void 0===s?void 0:s.kernel;if(!n)return!1;const i=this._parent;if(t.parent_header.session===n.clientId)return!1;const o=t.header.msg_type,r=t.parent_header.msg_id;let l;switch(o){case"execute_input":{const e=t;l=this._newCell(r);const s=l.model;return s.executionCount=e.content.execution_count,s.value.text=e.content.code,s.trusted=!0,i.update(),!0}case"execute_result":case"display_data":case"stream":case"error":{if(l=this._parent.getCell(r),!l)return!1;const e=Object.assign(Object.assign({},t.content),{output_type:o});return l.model.outputs.add(e),i.update(),!0}case"clear_output":{const e=t.content.wait;return l=this._parent.getCell(r),l&&l.model.outputs.clear(e),!0}default:return!1}}_newCell(e){const t=this.parent.createCodeCell();return t.addClass("jp-CodeConsole-foreignCell"),this._parent.addCell(t,e),t}}class r{constructor(e){this._cursor=0,this._hasSession=!1,this._history=[],this._placeholder="",this._setByHistory=!1,this._isDisposed=!1,this._editor=null,this._filtered=[],this.sessionContext=e.sessionContext,this._handleKernel(),this.sessionContext.kernelChanged.connect(this._handleKernel,this)}get editor(){return this._editor}set editor(e){if(this._editor===e)return;const t=this._editor;t&&(t.edgeRequested.disconnect(this.onEdgeRequest,this),t.model.value.changed.disconnect(this.onTextChange,this)),this._editor=e,e&&(e.edgeRequested.connect(this.onEdgeRequest,this),e.model.value.changed.connect(this.onTextChange,this))}get placeholder(){return this._placeholder}get isDisposed(){return this._isDisposed}dispose(){this._isDisposed=!0,this._history.length=0,i.Signal.clearData(this)}back(e){this._hasSession||(this._hasSession=!0,this._placeholder=e,this.setFilter(e),this._cursor=this._filtered.length-1),--this._cursor,this._cursor=Math.max(0,this._cursor);const t=this._filtered[this._cursor];return Promise.resolve(t)}forward(e){this._hasSession||(this._hasSession=!0,this._placeholder=e,this.setFilter(e),this._cursor=this._filtered.length),++this._cursor,this._cursor=Math.min(this._filtered.length-1,this._cursor);const t=this._filtered[this._cursor];return Promise.resolve(t)}push(e){e&&e!==this._history[this._history.length-1]&&this._history.push(e),this.reset()}reset(){this._cursor=this._history.length,this._hasSession=!1,this._placeholder=""}onHistory(e){this._history.length=0;let t="",s="";if("ok"===e.content.status)for(let n=0;n<e.content.history.length;n++)s=e.content.history[n][2],s!==t&&this._history.push(t=s);this._cursor=this._history.length}onTextChange(){this._setByHistory?this._setByHistory=!1:this.reset()}onEdgeRequest(e,t){const s=e.model,n=s.value.text;"top"===t||"topLine"===t?this.back(n).then((t=>{if(this.isDisposed||!t)return;if(s.value.text===t)return;this._setByHistory=!0,s.value.text=t;let n=0;n=t.indexOf("\n"),n<0&&(n=t.length),e.setCursorPosition({line:0,column:n})})):this.forward(n).then((t=>{if(this.isDisposed)return;const n=t||this.placeholder;if(s.value.text===n)return;this._setByHistory=!0,s.value.text=n;const i=e.getPositionAt(n.length);i&&e.setCursorPosition(i)}))}async _handleKernel(){var e;const t=null===(e=this.sessionContext.session)||void 0===e?void 0:e.kernel;if(t)return t.requestHistory(n.initialRequest).then((e=>{this.onHistory(e)}));this._history.length=0}setFilter(e=""){this._filtered.length=0;let t="",s="";for(let n=0;n<this._history.length;n++)s=this._history[n],s!==t&&e===s.slice(0,e.length)&&this._filtered.push(t=s);this._filtered.push(e)}}!function(e){e.initialRequest={output:!1,raw:!0,hist_access_type:"tail",n:500}}(n||(n={}));var l=s(67906),a=s(98838),h=s(46287),d=s(30742),c=s(66065),u=s(77031),p=s(92941),_=s(86839),C=s(79028),m=s(66148);const y="jp-Console-cell",g="jp-CodeConsole-promptCell";class x extends u.Widget{constructor(e){super(),this._banner=null,this._executed=new i.Signal(this),this._mimetype="text/x-ipython",this._msgIds=new Map,this._msgIdCells=new Map,this._promptCellCreated=new i.Signal(this),this._dragData=null,this._drag=null,this._focusedCell=null,this.addClass("jp-CodeConsole"),this.node.dataset.jpKernelUser="true",this.node.dataset.jpCodeRunner="true",this.node.tabIndex=-1;const t=this.layout=new u.PanelLayout;this._cells=new _.a,this._content=new u.Panel,this._input=new u.Panel,this.contentFactory=e.contentFactory||x.defaultContentFactory,this.modelFactory=e.modelFactory||x.defaultModelFactory,this.rendermime=e.rendermime,this.sessionContext=e.sessionContext,this._mimeTypeService=e.mimeTypeService,this._content.addClass("jp-CodeConsole-content"),this._input.addClass("jp-CodeConsole-input"),t.addWidget(this._content),t.addWidget(this._input),this._history=new r({sessionContext:this.sessionContext}),this._onKernelChanged(),this.sessionContext.kernelChanged.connect(this._onKernelChanged,this),this.sessionContext.statusChanged.connect(this._onKernelStatusChanged,this)}get executed(){return this._executed}get promptCellCreated(){return this._promptCellCreated}get cells(){return this._cells}get promptCell(){return this._input.layout.widgets[0]||null}addCell(e,t){e.addClass(y),this._content.addWidget(e),this._cells.push(e),t&&(this._msgIds.set(t,e),this._msgIdCells.set(e,t)),e.disposed.connect(this._onCellDisposed,this),this.update()}addBanner(){if(this._banner){const e=this._banner;this._cells.push(this._banner),e.disposed.connect(this._onCellDisposed,this)}const e=this.modelFactory.createRawCell({});e.value.text="...";const t=(this._banner=new p.RawCell({model:e,contentFactory:this.contentFactory})).initializeState();t.addClass("jp-CodeConsole-banner"),t.readOnly=!0,this._content.addWidget(t)}clear(){const e=this._cells;for(;e.length>0;)e.get(0).dispose()}createCodeCell(){const e=this.contentFactory,t=this._createCodeCellOptions(),s=e.createCodeCell(t);return s.readOnly=!0,s.model.mimeType=this._mimetype,s}dispose(){this.isDisposed||(this._cells.clear(),this._msgIdCells=null,this._msgIds=null,this._history.dispose(),super.dispose())}async execute(e=!1,t=250){var s,n;if("dead"===(null===(n=null===(s=this.sessionContext.session)||void 0===s?void 0:s.kernel)||void 0===n?void 0:n.status))return;const i=this.promptCell;if(!i)throw new Error("Cannot execute without a prompt cell");if(i.model.trusted=!0,e)return this.newPromptCell(),void await this._execute(i);const o=await this._shouldExecute(t);this.isDisposed||(o?(this.newPromptCell(),this.promptCell.editor.focus(),await this._execute(i)):i.editor.newIndentedLine())}getCell(e){return this._msgIds.get(e)}inject(e,t={}){const s=this.createCodeCell();s.model.value.text=e;for(const e of Object.keys(t))s.model.metadata.set(e,t[e]);return this.addCell(s),this._execute(s)}insertLinebreak(){const e=this.promptCell;e&&e.editor.newIndentedLine()}replaceSelection(e){var t,s;const n=this.promptCell;n&&(null===(s=(t=n.editor).replaceSelection)||void 0===s||s.call(t,e))}serialize(){const e=[];return(0,C.each)(this._cells,(t=>{const s=t.model;(0,p.isCodeCellModel)(s)&&e.push(s.toJSON())})),this.promptCell&&e.push(this.promptCell.model.toJSON()),e}_evtMouseDown(e){const{button:t,shiftKey:s}=e;if(0!==t&&2!==t||s&&2===t)return;let n=e.target;const i=e=>e.classList.contains(y);let o=p.CellDragUtils.findCell(n,this._cells,i);if(-1===o&&(n=document.elementFromPoint(e.clientX,e.clientY),o=p.CellDragUtils.findCell(n,this._cells,i)),-1===o)return;const r=this._cells.get(o);"prompt"===p.CellDragUtils.detectTargetArea(r,e.target)&&(this._dragData={pressX:e.clientX,pressY:e.clientY,index:o},this._focusedCell=r,document.addEventListener("mouseup",this,!0),document.addEventListener("mousemove",this,!0),e.preventDefault())}_evtMouseMove(e){const t=this._dragData;t&&p.CellDragUtils.shouldStartDrag(t.pressX,t.pressY,e.clientX,e.clientY)&&this._startDrag(t.index,e.clientX,e.clientY)}_startDrag(e,t,s){const n=this._focusedCell.model,i=[n.toJSON()],o=p.CellDragUtils.createCellDragImage(this._focusedCell,i);this._drag=new m.Drag({mimeData:new c.MimeData,dragImage:o,proposedAction:"copy",supportedActions:"copy",source:this}),this._drag.mimeData.setData("application/vnd.jupyter.cells",i);const r=n.value.text;return this._drag.mimeData.setData("text/plain",r),this._focusedCell=null,document.removeEventListener("mousemove",this,!0),document.removeEventListener("mouseup",this,!0),this._drag.start(t,s).then((()=>{this.isDisposed||(this._drag=null,this._dragData=null)}))}handleEvent(e){switch(e.type){case"keydown":this._evtKeyDown(e);break;case"mousedown":this._evtMouseDown(e);break;case"mousemove":this._evtMouseMove(e);break;case"mouseup":this._evtMouseUp(e)}}onAfterAttach(e){const t=this.node;t.addEventListener("keydown",this,!0),t.addEventListener("click",this),t.addEventListener("mousedown",this),this.promptCell?(this.promptCell.editor.focus(),this.update()):this.newPromptCell()}onBeforeDetach(e){const t=this.node;t.removeEventListener("keydown",this,!0),t.removeEventListener("click",this)}onActivateRequest(e){const t=this.promptCell&&this.promptCell.editor;t&&t.focus(),this.update()}newPromptCell(){let e=this.promptCell;const t=this._input;e&&(e.readOnly=!0,e.removeClass(g),i.Signal.clearData(e.editor),t.widgets[0].parent=null,this.addCell(e));const s=this.contentFactory,n=this._createCodeCellOptions();e=s.createCodeCell(n),e.model.mimeType=this._mimetype,e.addClass(g),this._input.addWidget(e);const o=e.editor;o.addKeydownHandler(this._onEditorKeydown),this._history.editor=o,this._promptCellCreated.emit(e)}onUpdateRequest(e){v.scrollToBottom(this._content.node)}_evtKeyDown(e){const t=this.promptCell&&this.promptCell.editor;t&&(13!==e.keyCode||t.hasFocus()?27===e.keyCode&&t.hasFocus()&&(e.preventDefault(),e.stopPropagation(),this.node.focus()):(e.preventDefault(),t.focus()))}_evtMouseUp(e){this.promptCell&&this.promptCell.node.contains(e.target)&&this.promptCell.editor.focus()}_execute(e){const t=e.model.value.text;return this._history.push(t),"clear"===t||"%clear"===t?(this.clear(),Promise.resolve(void 0)):(e.model.contentChanged.connect(this.update,this),p.CodeCell.execute(e,this.sessionContext).then((t=>{if(!this.isDisposed){if(t&&"ok"===t.content.status){const s=t.content;if(s.payload&&s.payload.length){const t=s.payload.filter((e=>"set_next_input"===e.source))[0];if(t){const s=t.text;e.model.value.text=s}}}else t&&"error"===t.content.status&&(0,C.each)(this._cells,(e=>{null===e.model.executionCount&&e.setPrompt("")}));e.model.contentChanged.disconnect(this.update,this),this.update(),this._executed.emit(new Date)}}),(()=>{this.isDisposed||(e.model.contentChanged.disconnect(this.update,this),this.update())})))}_handleInfo(e){if("ok"!==e.status)return void(this._banner.model.value.text="Error in getting kernel banner");this._banner.model.value.text=e.banner;const t=e.language_info;this._mimetype=this._mimeTypeService.getMimeTypeByLanguage(t),this.promptCell&&(this.promptCell.model.mimeType=this._mimetype)}_createCodeCellOptions(){const e=this.contentFactory;return{model:this.modelFactory.createCodeCell({}),rendermime:this.rendermime,contentFactory:e}}_onCellDisposed(e,t){if(!this.isDisposed){this._cells.removeValue(e);const t=this._msgIdCells.get(e);t&&(this._msgIdCells.delete(e),this._msgIds.delete(t))}}_shouldExecute(e){const t=this.promptCell;if(!t)return Promise.resolve(!1);const s=t.model.value.text;return new Promise(((t,n)=>{var i;const o=setTimeout((()=>{t(!0)}),e),r=null===(i=this.sessionContext.session)||void 0===i?void 0:i.kernel;r?r.requestIsComplete({code:s}).then((e=>{clearTimeout(o),this.isDisposed&&t(!1),"incomplete"===e.content.status?t(!1):t(!0)})).catch((()=>{t(!0)})):t(!1)}))}_onEditorKeydown(e,t){return 13===t.keyCode}async _onKernelChanged(){var e;this.clear(),this._banner&&(this._banner.dispose(),this._banner=null),this.addBanner(),(null===(e=this.sessionContext.session)||void 0===e?void 0:e.kernel)&&this._handleInfo(await this.sessionContext.session.kernel.info)}async _onKernelStatusChanged(){var e;const t=null===(e=this.sessionContext.session)||void 0===e?void 0:e.kernel;"restarting"===(null==t?void 0:t.status)&&(this.addBanner(),this._handleInfo(await(null==t?void 0:t.info)))}}var v;!function(e){class t extends p.Cell.ContentFactory{createCodeCell(e){return e.contentFactory||(e.contentFactory=this),new p.CodeCell(e).initializeState()}createRawCell(e){return e.contentFactory||(e.contentFactory=this),new p.RawCell(e).initializeState()}}e.ContentFactory=t,e.defaultContentFactory=new t;class s{constructor(e={}){this.codeCellContentFactory=e.codeCellContentFactory||p.CodeCellModel.defaultContentFactory}createCodeCell(e){return e.contentFactory||(e.contentFactory=this.codeCellContentFactory),new p.CodeCellModel(e)}createRawCell(e){return new p.RawCellModel(e)}}e.ModelFactory=s,e.defaultModelFactory=new s({})}(x||(x={})),function(e){e.scrollToBottom=function(e){e.scrollTop=e.scrollHeight-e.clientHeight}}(v||(v={}));var f,w=s(67070);class D extends l.MainAreaWidget{constructor(e){super({content:new u.Panel}),this._executed=null,this._connected=null,this.addClass("jp-ConsolePanel");let{rendermime:t,mimeTypeService:s,path:n,basePath:i,name:o,manager:r,modelFactory:a,sessionContext:p,translator:_}=e;this.translator=_||w.nullTranslator;const C=this.translator.load("jupyterlab"),m=this.contentFactory=e.contentFactory||D.defaultContentFactory,y=f.count++;n||(n=`${i||""}/console-${y}-${c.UUID.uuid4()}`),p=this._sessionContext=p||new l.SessionContext({sessionManager:r.sessions,specsManager:r.kernelspecs,path:n,name:o||C.__("Console %1",y),type:"console",kernelPreference:e.kernelPreference,setBusy:e.setBusy});const g=new h.RenderMimeRegistry.UrlResolver({session:p,contents:r.contents});t=t.clone({resolver:g}),this.console=m.createConsole({rendermime:t,sessionContext:p,mimeTypeService:s,contentFactory:m,modelFactory:a}),this.content.addWidget(this.console),p.initialize().then((async e=>{e&&await l.sessionContextDialogs.selectKernel(p),this._connected=new Date,this._updateTitlePanel()})),this.console.executed.connect(this._onExecuted,this),this._updateTitlePanel(),p.kernelChanged.connect(this._updateTitlePanel,this),p.propertyChanged.connect(this._updateTitlePanel,this),this.title.icon=d.consoleIcon,this.title.closable=!0,this.id=`console-${y}`}get sessionContext(){return this._sessionContext}dispose(){this.sessionContext.dispose(),this.console.dispose(),super.dispose()}onActivateRequest(e){const t=this.console.promptCell;t&&t.editor.focus()}onCloseRequest(e){super.onCloseRequest(e),this.dispose()}_onExecuted(e,t){this._executed=t,this._updateTitlePanel()}_updateTitlePanel(){f.updateTitle(this,this._connected,this._executed,this.translator)}}!function(e){class t extends x.ContentFactory{createConsole(e){return new x(e)}}e.ContentFactory=t,e.defaultContentFactory=new t,e.IContentFactory=new c.Token("@jupyterlab/console:IContentFactory")}(D||(D={})),function(e){e.count=1,e.updateTitle=function(e,t,s,n){const i=(n=n||w.nullTranslator).load("jupyterlab"),o=e.console.sessionContext.session;if(o){let n=i.__("Name: %1\n",o.name)+i.__("Directory: %1\n",a.PathExt.dirname(o.path))+i.__("Kernel: %1",e.console.sessionContext.kernelDisplayName);t&&(n+=i.__("\nConnected: %1",a.Time.format(t.toISOString()))),s&&(n+=i.__("\nLast Execution: %1")),e.title.label=o.name,e.title.caption=n}else e.title.label=i.__("Console"),e.title.caption=""}}(f||(f={}));const I=new c.Token("@jupyterlab/console:IConsoleTracker")},86839:(e,t,s)=>{"use strict";s.d(t,{a:()=>r});var n,i=s(79028),o=s(58137);class r{constructor(e={}){this._array=[],this._isDisposed=!1,this._changed=new o.Signal(this),void 0!==e.values&&(0,i.each)(e.values,(e=>{this._array.push(e)})),this._itemCmp=e.itemCmp||n.itemCmp}get type(){return"List"}get changed(){return this._changed}get length(){return this._array.length}get isDisposed(){return this._isDisposed}dispose(){this._isDisposed||(this._isDisposed=!0,o.Signal.clearData(this),this.clear())}iter(){return new i.ArrayIterator(this._array)}get(e){return this._array[e]}set(e,t){const s=this._array[e];if(void 0===t)throw new Error("Cannot set an undefined item");(0,this._itemCmp)(s,t)||(this._array[e]=t,this._changed.emit({type:"set",oldIndex:e,newIndex:e,oldValues:[s],newValues:[t]}))}push(e){const t=this._array.push(e);return this._changed.emit({type:"add",oldIndex:-1,newIndex:this.length-1,oldValues:[],newValues:[e]}),t}insert(e,t){i.ArrayExt.insert(this._array,e,t),this._changed.emit({type:"add",oldIndex:-1,newIndex:e,oldValues:[],newValues:[t]})}removeValue(e){const t=this._itemCmp,s=i.ArrayExt.findFirstIndex(this._array,(s=>t(s,e)));return this.remove(s),s}remove(e){const t=i.ArrayExt.removeAt(this._array,e);if(void 0!==t)return this._changed.emit({type:"remove",oldIndex:e,newIndex:-1,newValues:[],oldValues:[t]}),t}clear(){const e=this._array.slice();this._array.length=0,this._changed.emit({type:"remove",oldIndex:0,newIndex:0,newValues:[],oldValues:e})}move(e,t){if(this.length<=1||e===t)return;const s=[this._array[e]];i.ArrayExt.move(this._array,e,t),this._changed.emit({type:"move",oldIndex:e,newIndex:t,oldValues:s,newValues:s})}pushAll(e){const t=this.length;return(0,i.each)(e,(e=>{this._array.push(e)})),this._changed.emit({type:"add",oldIndex:-1,newIndex:t,oldValues:[],newValues:(0,i.toArray)(e)}),this.length}insertAll(e,t){const s=e;(0,i.each)(t,(t=>{i.ArrayExt.insert(this._array,e++,t)})),this._changed.emit({type:"add",oldIndex:-1,newIndex:s,oldValues:[],newValues:(0,i.toArray)(t)})}removeRange(e,t){const s=this._array.slice(e,t);for(let s=e;s<t;s++)i.ArrayExt.removeAt(this._array,e);return this._changed.emit({type:"remove",oldIndex:e,newIndex:-1,oldValues:s,newValues:[]}),this.length}}!function(e){e.itemCmp=function(e,t){return e===t}}(n||(n={}))}}]);
//# sourceMappingURL=9779.bundle.js.map