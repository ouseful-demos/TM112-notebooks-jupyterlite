(self.webpackChunk_JUPYTERLAB_CORE_OUTPUT=self.webpackChunk_JUPYTERLAB_CORE_OUTPUT||[]).push([[7415],{57415:(e,t,s)=>{"use strict";s.r(t),s.d(t,{IDocumentProviderFactory:()=>u,ProviderMock:()=>a,WebSocketProviderWithLocks:()=>c});var n=s(90355),i=s(8263),o=s(49e3),r=s(23406);class c extends i.V{constructor(e){super(e.url,e.guid,e.ymodel.ydoc,{awareness:e.ymodel.awareness}),this._currentLockRequest=null,this._initialContentRequest=null,this.messageHandlers[127]=(e,t,s,n,i)=>{const r=o.Jl(t),c=this._currentLockRequest;this._currentLockRequest=null,c&&c.resolve(r)},this.messageHandlers[125]=(e,t,s,i,r)=>{const c=o.iU(t);c.byteLength>0&&setTimeout((()=>{n.NG(this.doc,c)}),0);const a=this._initialContentRequest;this._initialContentRequest=null,a&&a.resolve(c.byteLength>0)},this.isInitialized=!1,this.onConnectionStatus=this.onConnectionStatus.bind(this),this.on("status",this.onConnectionStatus)}requestInitialContent(){if(this._initialContentRequest)return this._initialContentRequest.promise;let e,t;const s=new Promise(((s,n)=>{e=s,t=n}));return this._initialContentRequest={promise:s,resolve:e,reject:t},this._sendMessage(new Uint8Array([125])),setTimeout((()=>e(!1)),1e3),s}async onConnectionStatus(e){if(this.isInitialized&&"connected"===e.status){const e=await this.acquireLock();await this.requestInitialContent()||this.putInitializedState(),this.releaseLock(e)}}putInitializedState(){const e=r.Mf();r.uE(e,124),r.HK(e,n.D$(this.doc)),this._sendMessage(r._f(e)),this.isInitialized=!0}acquireLock(){if(this._currentLockRequest)return this._currentLockRequest.promise;this._sendMessage(new Uint8Array([127]));const e=setInterval((()=>{this.wsconnected&&this._sendMessage(new Uint8Array([127]))}),500);let t,s;const n=new Promise(((e,n)=>{t=e,s=n}));this._currentLockRequest={promise:n,resolve:t,reject:s};const i=()=>{clearInterval(e)};return n.then(i,i),n}releaseLock(e){const t=r.Mf();r.uE(t,126),r.Ep(t,e),this._sendMessage(r._f(t))}_sendMessage(e){const t=()=>{setTimeout((()=>{this.wsconnected?this.ws.send(e):this.once("status",t)}),0)};t()}}class a{requestInitialContent(){return Promise.resolve(!1)}putInitializedState(){}acquireLock(){return Promise.resolve(0)}releaseLock(e){}destroy(){}}const u=new(s(66065).Token)("@jupyterlab/docprovider:IDocumentProviderFactory")}}]);
//# sourceMappingURL=7415.bundle.js.map